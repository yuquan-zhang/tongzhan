<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../../css/app.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">建言编辑</h1>
		</header>
		<div class="mui-content">
		    <div class="mui-scroll-wrapper zui-scroll-wrapper"
		        <div class="mui-scroll">
		            <!--这里放置真实显示的DOM内容-->
		            <form id="vue1" class="mui-input-group">
						<div class="mui-input-row">
							<label>姓名</label>
							<input id='username' type="text" class="mui-input-clear mui-input" placeholder="" disabled="disabled">
						</div>
						<div class="mui-input-row" id="typePick">
							<label>界别</label>
							<input id='sugtype' type="text" class="mui-input-clear mui-input" placeholder="点击选择" readonly="readonly">
						</div>
						
						<div class="mui-input-row">
							<label>标题</label>
							<input id='title' type="text" class="mui-input-clear mui-input" placeholder="请输入标题">
						</div>
						<div class="mui-input-row" style="height: auto">
							<label>内容</label>
							<textarea id='content' rows="5" cols="50" class="mui-input-clear mui-input" placeholder="请输入您的建言献策"></textarea>
						</div>
						
					</form>
					<div class="mui-content-padded">
						<button id='submitBtn' class="mui-btn mui-btn-primary">提交</button>
						<button id='saveBtn' class="mui-btn mui-btn-primary mui-pull-right">保存</button>
					</div>
		        </div>
		    </div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script src="../../js/app.js"></script>
		<script type="text/javascript">
			(function($,doc){
				$.init();
				//阻尼系数
				var deceleration = $.os.ios?0.003:0.0009;
				$('.mui-scroll-wrapper').scroll({
					bounce: false,
					indicators: true, //是否显示滚动条
					deceleration:deceleration
				});
				
				var thisView = {};
				
				window.addEventListener("data_transfer",function(e){
					console.log(JSON.stringify(e.detail.data));
					thisView.data = e.detail.data;
					thisView.suggest = e.detail.suggest || {};
					
					document.getElementById("username").value = thisView.data.name || '';
					document.getElementById("sugtype").value = thisView.suggest.typeText || '';
					document.getElementById("sugtype").placeholder = thisView.suggest.type || '';
					document.getElementById("title").value = thisView.suggest.title || '';
					document.getElementById("content").value = thisView.suggest.content || '';
				},false);
				
				$.plusReady(function(){
					var sugTypes = [
						{
							value:"ALL",
							text:"所有界别",
						},
						{
							value:"MM",
							text:"民盟",
						},
						{
							value:"MG",
							text:"民革",
						}
					];
					var sugTypePicker = new mui.PopPicker();
					sugTypePicker.setData(sugTypes);
					var typeBtn = doc.getElementById("typePick");
					var typeResult = doc.getElementById("sugtype");
					typeBtn.addEventListener("tap", function(event) {
						sugTypePicker.show(function(items) {
							typeResult.value = items[0].text;
							typeResult.placeholder = items[0].value;
							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
					
					function uploadData(url) {
						var sugtype = doc.getElementById("sugtype");
			      		var title = doc.getElementById("title").value;
			      		var content = doc.getElementById("content").value;
			      		if(App.util.isEmpty(sugtype.value,"请选择界别")) return;
			      		if(App.util.isEmpty(title,"请输入标题")) return;
			      		if(App.util.isEmpty(content,"请输入内容")) return;
			      		var updata = {
			      			createUserId:thisView.data.webAccount.id,
			      			id:thisView.suggest.id || '',
			      			type:sugtype.placeholder,
			      			title,
			      			content
			      		}
						App.ajax({
							line: 123,
							url: url,
							data:updata,
							success: function(data) {
								mui.toast(data.data);
								mui.back();
							}
						})
					}
					
					doc.getElementById("submitBtn").addEventListener("tap",function(){
						uploadData("/front/suggest/sugSubmit.do")
					})
					doc.getElementById("saveBtn").addEventListener("tap",function(){
						uploadData("/front/suggest/sugSave.do")
					})
				})
			})(mui,document);
			
			var oldBack = mui.back;
			mui.back = function() {
				var opener = plus.webview.currentWebview().opener();
				opener.evalJS("pulldownRefresh()");
				oldBack();
			}
		</script>
	</body>

</html>